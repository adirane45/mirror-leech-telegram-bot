# Alert Rules for MLTB Phase 1 Monitoring
groups:
  - name: mltb_system
    interval: 30s
    rules:
      # System Performance Alerts
      - alert: HighCPUUsage
        expr: mltb_cpu_usage_percent > 80
        for: 5m
        labels:
          severity: critical
        annotations:
          summary: "High CPU usage detected"
          description: "CPU usage is {{ $value }}% on {{ $labels.instance }}"

      - alert: HighMemoryUsage
        expr: mltb_memory_usage_percent > 85
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "High memory usage detected"
          description: "Memory usage is {{ $value }}% on {{ $labels.instance }}"

      - alert: LowDiskSpace
        expr: mltb_disk_usage_percent > 90
        for: 5m
        labels:
          severity: critical
        annotations:
          summary: "Low disk space"
          description: "Disk usage is {{ $value }}% on {{ $labels.instance }}"

  - name: mltb_application
    interval: 30s
    rules:
      # Download/Upload Monitoring
      - alert: HighErrorRate
        expr: rate(mltb_failed_tasks_total[5m]) > 0.1
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "High error rate detected"
          description: "Error rate is {{ $value }} errors/sec"

      - alert: NoActiveDownloads
        expr: mltb_active_downloads == 0
        for: 30m
        labels:
          severity: info
        annotations:
          summary: "No active downloads"
          description: "No downloads have been active for 30 minutes"

      - alert: TooManyQueuedTasks
        expr: mltb_queued_tasks > 1000
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "Too many queued tasks"
          description: "{{ $value }} tasks are queued"

  - name: mltb_services
    interval: 30s
    rules:
      # Service Health
      - alert: RedisDown
        expr: up{job="redis"} == 0
        for: 1m
        labels:
          severity: critical
        annotations:
          summary: "Redis service is down"
          description: "Redis instance has been down for 1 minute"

      - alert: MongoDBDown
        expr: up{job="mongodb"} == 0
        for: 1m
        labels:
          severity: critical
        annotations:
          summary: "MongoDB service is down"
          description: "MongoDB instance has been down for 1 minute"

      - alert: PrometheusDown
        expr: up{job="prometheus"} == 0
        for: 1m
        labels:
          severity: critical
        annotations:
          summary: "Prometheus service is down"
          description: "Prometheus instance has been down for 1 minute"

      - alert: GrafanaDown
        expr: up{job="grafana"} == 0
        for: 1m
        labels:
          severity: warning
        annotations:
          summary: "Grafana service is down"
          description: "Grafana instance has been down for 1 minute"

  - name: mltb_security
    interval: 30s
    rules:
      # Security Alerts
      - alert: AuthenticationFailures
        expr: rate(authentication_failures_total[5m]) > 10
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "Multiple authentication failures"
          description: "Authentication failure rate is {{ $value }} per second"

      - alert: UnauthorizedAPIAccess
        expr: rate(unauthorized_api_requests_total[5m]) > 5
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "Unauthorized API access attempts"
          description: "{{ $value }} unauthorized requests per second"

      - alert: RateLimitExceeded
        expr: rate(rate_limit_exceeded_total[5m]) > 10
        for: 5m
        labels:
          severity: info
        annotations:
          summary: "Rate limit exceeded"
          description: "{{ $value }} rate limit violations per second"

      - alert: SuspiciousActivity
        expr: rate(suspicious_activity_total[5m]) > 1
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "Suspicious activity detected"
          description: "{{ $value }} suspicious activities per second"
